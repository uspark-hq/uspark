# Code Review: 68643364

**Commit:** fix: remove upsert logic from GET /api/projects/:projectId endpoint (#754)
**Author:** Ethan Zhang <ethan@uspark.ai>
**Date:** Fri Oct 24 22:44:54 2025 -0700

## Summary

Removes upsert logic from GET endpoint to ensure proper REST API semantics (GET requests should be idempotent with no side effects).

## Changes Analysis

- `spec/todo.md` - Updated documentation
- `apps/web/app/api/projects/[projectId]/route.test.ts` - Added 404 test
- `apps/web/app/api/projects/[projectId]/route.ts` - Removed upsert (-44 lines)

## Review Against Bad Code Smells

### ✅ REST API Semantics
**Status: EXCELLENT** ⭐

**Problem:**
GET endpoint was creating projects when they didn't exist, violating REST principles.

**Before:**
```typescript
// GET creates data - violates REST
if (!project) {
  project = await createProject(userId, projectId);
}
return NextResponse.json(project);
```

**After:**
```typescript
// GET returns 404 - proper REST
if (!project) {
  return NextResponse.json(
    { error: "Project not found" },
    { status: 404 }
  );
}
return NextResponse.json(project);
```

### ✅ Test Coverage
**Status: EXCELLENT**

Added proper test case:
```typescript
it("should return 404 when project doesn't exist", async () => {
  const response = await GET(...);
  expect(response.status).toBe(404);

  // Verify project was NOT created
  const project = await db.select().from(PROJECTS_TBL);
  expect(project).toHaveLength(0);
});
```

### ✅ All Categories
- No side effects in GET (✅)
- Idempotent behavior (✅)
- All 82 tests pass (✅)
- No breaking changes (client handles 404 properly) (✅)

## Final Assessment

### Strengths
✅ **Proper REST API semantics**
✅ **GET requests now idempotent**
✅ **Removed 44 lines of unnecessary code**
✅ **Added test for 404 behavior**
✅ **Client code already handles 404**
✅ **Clear separation: POST creates, GET retrieves**

### Impact
- **Before:** GET had side effects (creates data)
- **After:** GET is idempotent (no side effects)

## Verdict

**APPROVED ✅**

Excellent fix that enforces REST principles and reduces code complexity.

---

## Code Quality Score: 100/100
