# E2E æµ‹è¯•å®‰å…¨æœ€ä½³å®è·µ

## ğŸ” å…³äº Secret Key çš„ä½¿ç”¨

### ä½•æ—¶å¯ä»¥ä½¿ç”¨ Secret Keyï¼ˆè°¨æ…ï¼‰

âœ… **å¼€å‘ç¯å¢ƒ**
- æœ¬åœ°å¼€å‘æµ‹è¯•
- ä½¿ç”¨ä¸“é—¨çš„æµ‹è¯•ç¯å¢ƒ Secret Keyï¼ˆä¸æ˜¯ç”Ÿäº§å¯†é’¥ï¼‰
- å¯†é’¥å­˜å‚¨åœ¨ `.env.local` ä¸­ï¼ˆå·²åŠ å…¥ .gitignoreï¼‰

âœ… **å®‰å…¨çš„ CI/CD**
- ä½¿ç”¨ GitHub Secrets æˆ–ç±»ä¼¼çš„å¯†é’¥ç®¡ç†æœåŠ¡
- CI ç¯å¢ƒè‡ªåŠ¨é®è”½æ—¥å¿—ä¸­çš„å¯†é’¥
- ä»…é™å†…éƒ¨/ç§æœ‰ä»“åº“

### ä½•æ—¶ä¸åº”ä½¿ç”¨ Secret Key

âŒ **å…¬å¼€ä»£ç **
- å¼€æºé¡¹ç›®
- å…¬å¼€çš„ç¤ºä¾‹ä»£ç 
- ä»£ç åˆ†äº«å¹³å°

âŒ **ä¸å®‰å…¨çš„ç¯å¢ƒ**
- ç¬¬ä¸‰æ–¹ CI æœåŠ¡ï¼ˆæœªé…ç½®å¯†é’¥ç®¡ç†ï¼‰
- å…±äº«çš„æµ‹è¯•ç¯å¢ƒ
- æ—¥å¿—æœªé®è”½çš„ç³»ç»Ÿ

## ğŸ›¡ï¸ æ¨èçš„å®‰å…¨æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šåˆ†ç¦»æµ‹è¯•ç¯å¢ƒï¼ˆæœ€ä½³ï¼‰

```env
# ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•åº”ç”¨ï¼ˆä¸ç”Ÿäº§éš”ç¦»ï¼‰
CLERK_TEST_PUBLISHABLE_KEY=pk_test_xxx  # æµ‹è¯•ç¯å¢ƒå¯†é’¥
CLERK_TEST_SECRET_KEY=sk_test_xxx       # ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨

# æµ‹è¯•ç”¨æˆ·ï¼ˆä¸“é—¨åˆ›å»ºçš„æµ‹è¯•è´¦æˆ·ï¼‰
E2E_CLERK_USER_USERNAME=e2e-test@example.com
E2E_CLERK_USER_PASSWORD=TestOnly123!
```

### æ–¹æ¡ˆ 2ï¼šä»…ä½¿ç”¨ UI ç™»å½•ï¼ˆæœ€å®‰å…¨ï¼‰

```javascript
// ä¸éœ€è¦ Secret Key
test('safe login', async ({ page }) => {
  await page.goto('/sign-in');
  await page.fill('input[name="identifier"]', process.env.E2E_USER);
  await page.fill('input[type="password"]', process.env.E2E_PASS);
  // ...
});
```

### æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ Testing Tokenï¼ˆæŠ˜ä¸­æ–¹æ¡ˆï¼‰

```bash
# ä» Clerk Dashboard æ‰‹åŠ¨è·å– Testing Token
# å®šæœŸæ›´æ–°ï¼Œä¸æäº¤åˆ°ä»£ç åº“
CLERK_TESTING_TOKEN=test_token_xxx
```

## ğŸ“Š å†³ç­–çŸ©é˜µ

| åœºæ™¯ | Secret Key | UI ç™»å½• | Testing Token |
|-----|------------|---------|---------------|
| æœ¬åœ°å¼€å‘ | âœ… å¯ä»¥ | âœ… æ¨è | âœ… å¯ä»¥ |
| ç§æœ‰ CI/CD | âš ï¸ è°¨æ… | âœ… æ¨è | âœ… å¯ä»¥ |
| å…¬å¼€ä»“åº“ | âŒ ç¦æ­¢ | âœ… æ¨è | âš ï¸ è°¨æ… |
| ç”Ÿäº§æµ‹è¯• | âŒ ç¦æ­¢ | âœ… æ¨è | âŒ é¿å… |

## ğŸ”‘ å¯†é’¥ç®¡ç†æ¸…å•

- [ ] ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œä¸ç¡¬ç¼–ç 
- [ ] `.env` æ–‡ä»¶åŠ å…¥ `.gitignore`
- [ ] CI/CD ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡
- [ ] å®šæœŸè½®æ¢å¯†é’¥
- [ ] ç›‘æ§å¼‚å¸¸ä½¿ç”¨
- [ ] ä½¿ç”¨æµ‹è¯•ç¯å¢ƒï¼Œä¸ç”¨ç”Ÿäº§å¯†é’¥
- [ ] æœ€å°æƒé™åŸåˆ™

## ğŸ’¡ å®ç”¨å»ºè®®

1. **å¼€å‘é˜¶æ®µ**ï¼šå¯ä»¥ä½¿ç”¨ `@clerk/testing` + Secret Key å¿«é€Ÿè¿­ä»£
2. **CI/CD é˜¶æ®µ**ï¼šä½¿ç”¨ GitHub Secrets å®‰å…¨å­˜å‚¨
3. **ç”Ÿäº§é˜¶æ®µ**ï¼šä»…ä½¿ç”¨ UI ç™»å½•æˆ–åªè¯»æµ‹è¯•
4. **å¼€æºé¡¹ç›®**ï¼šæä¾›æ–‡æ¡£è®©ç”¨æˆ·é…ç½®è‡ªå·±çš„å¯†é’¥

## ç¤ºä¾‹ï¼šGitHub Actions å®‰å…¨é…ç½®

```yaml
name: E2E Tests
on: [push]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Run E2E Tests
        env:
          # ä½¿ç”¨ GitHub Secretsï¼ˆä¸ä¼šæ˜¾ç¤ºåœ¨æ—¥å¿—ä¸­ï¼‰
          CLERK_SECRET_KEY: ${{ secrets.CLERK_TEST_SECRET_KEY }}
          E2E_USER: ${{ secrets.E2E_TEST_USERNAME }}
          E2E_PASS: ${{ secrets.E2E_TEST_PASSWORD }}
        run: npm test
```

## ç»“è®º

- **Clerk å®˜æ–¹æ–¹æ¡ˆ**ï¼ˆä½¿ç”¨ Secret Keyï¼‰æ˜¯ä¸ºäº†**ä¾¿åˆ©æ€§**
- **å®é™…ä½¿ç”¨**æ—¶éœ€è¦æ ¹æ®ç¯å¢ƒé€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆ
- **ä¼˜å…ˆè€ƒè™‘å®‰å…¨æ€§**ï¼Œç‰¹åˆ«æ˜¯åœ¨ç”Ÿäº§å’Œå…¬å¼€ç¯å¢ƒ
- **UI ç™»å½•**æ˜¯æœ€å®‰å…¨ä½†é€Ÿåº¦è¾ƒæ…¢çš„æ–¹æ¡ˆ
- **åˆç†ä½¿ç”¨**å¯†é’¥ç®¡ç†å·¥å…·å’Œç¯å¢ƒéš”ç¦»